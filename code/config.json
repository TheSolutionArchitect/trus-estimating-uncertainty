
{
  "model_name": "hdr-mcdo-v01-1",
  "description": "Adds a 3x2 uncertainty composite per slice and color-mapped EPI/PE/UNC images; preserves all prior features.",
  "paths": {
    "input_dir": "H:/HDR-MODEL/quick-testdata/raw-rgb",
    "mask_dir": "H:/HDR-MODEL/quick-testdata/mask",
    "output_dir": "H:/HDR-MODEL"
  },
  "model": {
    "arch": "SwinUNETR",
    "in_channels": 3,
    "out_channels": 1,
    "feature_size": 48,
    "drop_rate": 0.1,
    "spatial_dims": 2,
    "use_checkpoint": true
  },
  "train": {
    "img_size": [512, 512],
    "batch_size": 4,
    "accumulation_steps": 4,
    "max_epochs": 150,
    "patience": 15,
    "learning_rate": 0.001,
    "class_weight": 30.0,
    "use_amp": true,
    "micro_batch_size": null,
    "auto_microbatch_on_oom": true,
    "max_auto_microbatch_halvings": 3,
    "num_workers": 0,
    "plateau_reduce_factor": 0.5,
    "plateau_patience_epochs": 3,
    "early_stop_min_delta_mm": 0.0
  },
  "loss": {
    "focal_gamma": 3.0,
    "tversky_alpha": 0.6,
    "tversky_beta": 0.4,
    "combined_weights": [0.1, 0.7, 0.2]
  },
  "metrics": {
    "pred_threshold": 0.65,
    "min_component_size": 20,
    "pixel_to_mm": 0.0963,
    "detection_tolerance_mm": 3.0,
    "tolerance_sweep_mm": [2.0, 3.0, 5.0],
    "ci_confidence_level": 0.95,
    "prob_value_method": "centroid"
  },
  "cv": {
    "k_folds": 5,
    "random_state": 42,
    "test_size": 0.15,
    "evaluation_fold": "best",
    "stratify_by_patient": true
  },
  "augment": {
    "rotate90_prob": 0.5,
    "flip_prob": 0.5,
    "flip_axis": 0,
    "zoom_prob": 0.5,
    "min_zoom": 0.7,
    "max_zoom": 1.3,
    "gauss_noise_prob": 0.3,
    "gauss_noise_std": 0.01,
    "gauss_smooth_prob": 0.3,
    "gauss_sigma_x_min": 0.5,
    "gauss_sigma_x_max": 1.0,
    "adjust_contrast_prob": 0.3,
    "gamma_min": 0.7,
    "gamma_max": 1.3
  },
  "search": {
    "enabled": true,
    "strategy": "bayes_opt",
    "cv_n_splits": 5,
    "cv_n_repeats": 1,
    "cv_max_epochs": 50,
    "bayes_opt": {
      "n_trials": 8,
      "seed": 42,
      "param_space": {
        "train.learning_rate":   { "type": "float", "low": 0.0002, "high": 0.003, "log": true },
        "train.batch_size":      { "type": "int",   "low": 1, "high": 4, "step": 1 },
        "model.feature_size":    { "type": "int",   "low": 24, "high": 48, "step": 12 },
        "model.drop_rate":       { "type": "float", "low": 0.0, "high": 0.3 },
        "augment.flip_prob":     { "type": "float", "low": 0.2, "high": 0.8 },
        "augment.rotate90_prob": { "type": "float", "low": 0.2, "high": 0.8 },
        "augment.zoom_prob":     { "type": "float", "low": 0.2, "high": 0.8 },
        "metrics.pred_threshold":{ "type": "float", "low": 0.35, "high": 0.65 }
      }
    },
    "scoring": { "primary": "f1", "tie_breaker": "mean_ed_mm" }
  },
  "uncertainty": {
    "enabled": true,
    "mc_dropout": {
      "enabled": true,
      "num_samples": 15,
      "seed": 12345
    },
    "predictive_entropy": { "enabled": true },
    "epistemic": {
      "enabled": true,
      "measure": "mi"
    },
    "per_needle_pool": {
      "window_size": 11,
      "pool_type": "mean",
      "normalize": "minmax_slice"
    },
    "combine": {
      "enabled": true,
      "weight_pe": 0.5,
      "weight_epi": 0.5,
      "normalization": "minmax_slice"
    },
    "save_maps": {
      "enabled": true,
      "save_pe": true,
      "save_epi": true,
      "save_combined": true,
      "format": "png",
      "colormap": "magma",
      "colorbar": true
    }
  },
  "ensemble": { "enabled": false },
  "viz": {
    "save_val_vis": true,
    "max_val_vis_per_epoch": 100,
    "rotate_cw_90": false,
    "overlay_orientation": "rot90_ccw",
    "save_test_predictions": true,
    "test_pred_draw_radius": 4,
    "test_predictions_max_slices_per_patient": null,
    "overlay_prob_on_test_images": true,
    "prob_digits": 2,
    "prob_text_color": [255, 255, 0],
    "prob_font_size": 14,
    "prob_font_path": null,
    "prob_label_prefix": "",
    "collage_dpi": 140,
    "collage_figsize": [12, 10],
    "collage_title_fontsize": 12,
    "pred_point_color": [0, 1, 0],
    "pred_point_edgecolor": [1, 1, 0],
    "pred_point_radius_px": 7,
    "pred_point_linewidth": 1.5,
    "save_uncertainty_composite": true,
    "uncertainty_composite_figsize": [12, 14],
    "uncertainty_composite_dpi": 140,
    "uncertainty_title_fontsize": 12
  }

}
